# Configuration YAML file for JWST KL measurement

# parameters control the MCMC simulation settings
mcmc:
  nsteps: 30000
  #nsteps: 10
  monitor_autocorr: True
  data_filename_fmt: mockdata_compile_short_withmask_GDS_ID%d_emlonly.fits
  mockdata_output: /xdisk/timeifler/jiachuanxu/kltools_jwst_chains/mockdata_test.fits
  objid: 181661
  output: /xdisk/timeifler/jiachuanxu/kltools_jwst_chains/mockobj181661_shear_TFR_T1_testpoco
  sampled_theta_fid:
    g1: 0.0
    g2: 0.0
    theta_int: 0.0
    sini: 0.05
    dx_disk: 0.0
    dy_disk: 0.0
    dy_spec: 0.0
    v0: 0.0
    vcirc: 251.538
    rscale: 0.05
    hlr: 0.232
    em_PaA_flux: 4.4e-17
    em_PaA_hlr: 0.232
    em_PaA_sigma: 0.6
    flux: 768

# (Might be) sampled parameters in simulation
params:
  g1: 
#    value: 0.0
    prior: 
      min: -0.3
      max: 0.3
    ref:
      dist: norm
      loc: 0.0
      scale: 0.1
      proposal: 1.0e-4
    latex: g_1
  g2:
#    value: 0.0
    prior:
      min: -0.3
      max: 0.3
    ref:
      dist: norm
      loc: 0.0
      scale: 0.1
      proposal: 1.0e-4
    latex: g_2
  theta_int:
    prior:
      min: 0.5
      max: 1.5
      #min: -1.5708
      #max: 1.5708
    ref:
      dist: norm
      loc: 0.936227
      scale: 1.0e-3
      proposal: 1.0e-3
    latex: \theta_\mathrm{int}
  sini:
    prior:
      min: -0.99
      max: -0.6
      #min: -0.999
      #max: 0.999
    ref:
      dist: norm
      loc: -0.785
      scale: 0.001
      proposal: 0.001
    latex: \mathrm{sin}(i)
  g: 
    derived: "lambda g1, g2: np.sqrt(g1*g1 + g2*g2)"
    prior:
      min: 0.0
      max: 1.0
    latex: g
  eint1:
    derived: "lambda sini, theta_int: np.tan(0.5*np.arcsin(sini)) * np.cos(2*theta_int)"
    latex: e^\mathrm{int}_1
  eint2:
    derived: "lambda sini, theta_int: np.tan(0.5*np.arcsin(sini)) * np.sin(2*theta_int)"
    latex: e^\mathrm{int}_2
  dx_disk:
    prior:
      #min: -0.3
      #max: 0.3
      min: -0.02
      max: 0.02
    ref:
      dist: norm
      loc: 0.0
      scale: 0.05
      proposal: 0.05
    latex: \Deltax_\mathrm{disk}
  dy_disk:
    prior:
      #min: -0.3
      #max: 0.3
      min: -0.02
      max: 0.02
    ref:
      dist: norm
      loc: 0.0
      scale: 0.05
      proposal: 0.05
    latex: \Deltay_\mathrm{disk}
  dy_spec:
    prior:
      min: -0.3
      max: 0.3
    ref:
      dist: norm
      loc: 0.0
      scale: 0.05
      proposal: 0.05
    latex: \Deltay_\mathrm{spec}
  v0:
    prior:
      #min: -100.0
      #max: 100.0
      min: 20
      max: 80
    ref:
      dist: norm
      loc: 0.0
      scale: 0.1
      proposal: 1.0e-4
    latex: v_0
  vcirc:
    prior:
      #dist: lognorm
      #mu: 225.23
      #dex: 0.0749
      min: 200
      max: 400
      #min: 80
      #max: 800
    ref:
      dist: norm
      loc: 225.23
      scale: 1
      proposal: 1.0e-4
    latex: v_\mathrm{circ}
  rscale:
    prior:
      min: 0.001
      #max: 1.0
      max: 0.1
    ref:
      dist: norm
      loc: 0.05
      scale: 1.0e-4
      proposal: 1.0e-4
    latex: R_\mathrm{vscale}
  v22:
    derived: "lambda vcirc, hlr, rscale: vcirc/(np.pi/2.)*np.arctan(1.3*hlr/rscale)"
    prior:
      dist: lognorm
      mu: 225.23
      dex: 0.0749
      clip_sigmas: 3
    latex: V_{2.2}
  dx_kin:
    # prior:
    #   min: -0.3
    #   max: 0.3
    # ref:
    #   dist: norm
    #   loc: 0.0
    #   scale: 0.05
    #   proposal: 0.05
    value: 0.0
    latex: \Deltax_\mathrm{kin}
  dy_kin:
    # prior:
    #   min: -0.3
    #   max: 0.3
    # ref:
    #   dist: norm
    #   loc: 0.0
    #   scale: 0.05
    #   proposal: 0.05
    value: 0.0
    latex: \Deltay_\mathrm{kin}
  hlr:
    prior:
      min: 0.01
      #max: 1.0
      max: 0.3
    ref:
      dist: norm
      loc: 0.232 # measurement from JADES catalog, F444W
      scale: 0.01
      proposal: 1.0e-4
    latex: R_h
  em_PaA_flux:
    prior:
      #min: 2.8e-18
      #max: 2.8e-16
      min: 3.5e-17
      max: 5.0e-17
    ref:
      dist: norm
      loc: 2.8e-17
      scale: 1.0e-19
      proposal: 1.0e-19
    latex: F_\mathrm{H\alpha}
  em_PaA_hlr:
    prior:
      #min: 0.01
      #max: 1.0
      min: 0.1
      max: 0.3
    ref:
      dist: norm
      loc: 0.232
      scale: 0.01
      proposal: 1.0e-4
    latex: R_h^{Pa\alpha}
  em_PaA_sigma:
    prior:
      min: 0.065
      #max: 6.5
      max: 0.8
    ref:
      dist: norm
      loc: 0.65
      scale: 0.01
      proposal: 1.0e-4
#    value: 0.65
    latex: \sigma_{Pa\alpha}
  # cont_PaA_hlr:
  #   prior:
  #     min: 0.01
  #     max: 5.0
  #   ref:
  #     dist: norm
  #     loc: 1.0
  #     scale: 0.1
  #     proposal: 1.0e-4
  #   latex: R_h^{Pa\alpha-cont}
  flux:
    prior:
      #min: 7.0e+1
      #max: 7.0e+3
      min: 740
      max: 800
    ref:
      dist: norm
      loc: 768
      scale: 0.1
      proposal: 1.0e-4
    latex: F_\mathrm{phot}
  # obs_cont_norm_flam:
  #   #value: 3.0e-17
  #   value: 0.0
  #   # prior:
  #   #   min: 1.0e-14
  #   #   max: 1.0e+14
  #   # ref:
  #   #   dist: norm
  #   #   loc: 1.0
  #   #   scale: 0.1
  #   #   proposal: 1.0e-4
  #   latex: F_\mathrm{cont}

### Meta parameters used in simulation
meta:
  g1: param
  g2: param
#  g1: 0.0
#  g2: 0.0
#  eint1: param
#  eint2: param
  theta_int: param
  sini: param

  velocity:
    model: offset # default
    v0: param
    vcirc: param
    rscale: param
    dx_kin: param
    dy_kin: param

  intensity:
    type: inclined_exp
    flux: param
    hlr: param
    em_PaA_hlr: param
    #cont_PaA_hlr: param
    dx_disk: param
    dy_disk: param
    dx_spec: 0.0
    dy_spec: param

  psf: from_data

  units:
    v_unit: km/s
    r_unit: arcsec

  run_options:
    run_mode: FLUX # ETC or FLUX
    imap_return_gal: True
    use_numba: False
    alignment_params: sini_pa # eint, sini_pa, inc_pa, eint_eigen

  model_dimension:
    Nx: 100
    Ny: 100
    scale: 0.02
    lblue: 3800
    lred: 5200
    resolution: 5000
    #lambda_range: [[4886.499999999879, 4917.499999999875]]
    lambda_range: [[4871.0, 4933.0]]
    lambda_res: 0.25
    super_sampling: 2
    lambda_unit: nm

  sed:
    z: 1.6145
    continuum_type: func # `temp` for template, `func` for function
    continuum_func: "1.0 + wave * 0.0"
    #restframe_temp: ../data/Simulation/GSB2.spec
    temp_wave_type: Ang
    temp_flux_type: flambda
    cont_norm_method: flux
    obs_cont_norm_wave: 4440
    #obs_cont_norm_flam: param
    obs_cont_norm_flam: 0.0
    em_PaA_flux: param
    em_PaA_sigma: param # 0.65

  obs_conf:
    - NAXIS: 2
      NAXIS1: 31
      NAXIS2: 31
      EXTNAME: SPECCUTA
      # wavelength grid
      WAVE_1: 4.886499999999879
      D_WAVE: 0.000999999999999889
      OFFSET: -4902.1100000005445
      COMMENTS: "wave = wave_1 + np.arange(0, NAXIS1, 1) * d_wave"
      PIXSCALE: 0.0629
      APERTURE: 31
      EMISSION: PaA
      BUNIT: DN/s
      DISPANG: -0.00253000059467512
      OBSINDEX: 0
      INSTNAME: JWST/NIRCam
      OBSTYPE: grism
      # sensitivity if not in ETC mode
      BANDPASS: ../data/Bandpass/JWST/NIRCam_WFSS_F444W_modA_grismR_sensitivity.dat
      SEDBLKID: 0
      RSPEC: 500.0
      PSFTYPE: data
      PSFDATA: ../data/psf/JWST_NIRCam_WFSS_modA_PSF.fits
      NOISETYP: ccd
      ADDNOISE: True
      TEMP: 1.0
      ### if in ETC mode
      # RDNOISE: 2.6
      # SKYMODEL: ../data/Skyspectra/spec-sky.dat
      # DIAMETER: 332.42
      # EXPTIME: 180
      # GAIN: 1.0
      # NOISETYP: ccd
      # ADDNOISE: False
    - NAXIS: 2
      NAXIS1: 62
      NAXIS2: 62
      EXTNAME: F444WIMG
      BUNIT: MJy/sr
      PIXAR_SR: 2.11465740855697E-14
      PIXAR_A2: 0.000899684595650763
      PIXSCALE: 0.029994742800210222
      OBSINDEX: 1
      INSTNAME: JWST/NIRCam
      OBSTYPE: image
      PSFTYPE: data
      PSFDATA: ../data/psf/JWST_NIRCam_F444W_modA_PSF.fits
      MASKDATA: ../data/mask/JWST_NIRCam_F444W_modA_mask.fits
      NOISETYP: ccd
      ADDNOISE: True
      TEMP: 1
      # do not need bandpass in flux mode
      #BANDPASS:
      ### if in ETC mode
      # SKYLEVEL: 44.54
      # EXPTIME: 4000
      # PIXSCALE: 0.003
      # PSFFWHM: 1.0
      # DIAMETER: 378.2856
      # GAIN: 4.0
      # NOISETYP: ccd
      # RDNOISE: 7
      # ADDNOISE: False
